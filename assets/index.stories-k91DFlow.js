import{j as n,c as re,C as ce,H as le,T}from"./index-Cc0r8_xM.js";import{r}from"./index-DVXBtNgz.js";const ae=9,ie=13,de=27,pe=32,me=40,fe=38,xe=39,ye=37,he=(e,t,o=0)=>{e.scrollTop=t.offsetTop-o},ge=5,$=(e,t,o=ge)=>{t.offsetTop-e.scrollTop<0?he(e,t,o):t.offsetTop+t.offsetHeight-e.scrollTop-e.clientHeight>0&&(e.scrollTop=t.offsetTop-e.clientHeight+t.offsetHeight+o)},Ee=e=>{const t=r.useRef(null);return r.useEffect(()=>{const o=p=>{!t.current||t.current.contains(p.target)||e(p)},c={passive:!0};return document.addEventListener("mousedown",o,c),document.addEventListener("touchstart",o,c),()=>{document.removeEventListener("mousedown",o,c),document.removeEventListener("touchstart",o,c)}},[e]),t},Ce=()=>{const e=r.useRef({}),t=r.useCallback((o,c)=>{if(c==null){delete e.current[o];return}e.current={...e.current,[o]:c}},[]);return[e,t]},H={isOpen:!1,keyboardFocusIndex:null,mouseFocusIndex:null},_e=()=>{const[e,t]=r.useState(H),o=r.useCallback(()=>{t(H)},[]),c=r.useCallback(()=>{t(i=>({...i,isOpen:!0}))},[]),p=r.useCallback(i=>{t(a=>({...a,keyboardFocusIndex:i,mouseFocusIndex:null}))},[]),x=r.useCallback(i=>{t(a=>({...a,mouseFocusIndex:i,keyboardFocusIndex:null}))},[]);return{...e,closeDropdown:o,openDropdown:c,setKeyboardFocusIndex:p,setMouseFocusIndex:x}},be=()=>`${String.fromCharCode(Math.random()*26+97)}${Math.random().toString(36).substr(2,28)}`,Ie=e=>r.useMemo(()=>be(),[e]),ke=e=>`${e}-drpdwn`,ve=(e,t)=>`${e}-${t}`,De=e=>{const t=Ie(e);return r.useMemo(()=>({containerId:t,dropdownId:ke(t),getOptionId:o=>ve(t,o)}),[t])},Be=({isOpen:e,getIndexToScroll:t,dropdown:o,optionsMapRef:c,optionsGap:p})=>{const[x,i]=r.useState(!1);r.useLayoutEffect(()=>{i(e)},[e]),r.useLayoutEffect(()=>{if(e&&x){const a=t(),E=c.current[a];E&&o&&$(o,E,p),i(!1)}},[o,t,e,x,p,c])},je=({value:e,onChange:t,onSubmit:o,optionsGap:c,rawOptionsData:p,pickerLabel:x,multiple:i,navigationOrientation:a="vertical",horizontalNavigationStep:E=1,verticalNavigationStep:_=1})=>{const b=r.useRef(null),h=r.useRef(null),[I,y]=Ce(),{dropdownId:C,getOptionId:k}=De(),{isOpen:s,openDropdown:m,closeDropdown:d,keyboardFocusIndex:v,setKeyboardFocusIndex:S,mouseFocusIndex:te,setMouseFocusIndex:A}=_e(),ne=Ee(()=>{s&&d()});r.useImperativeHandle(ne,()=>b.current);const D=()=>te||v||0,R=()=>{t([]),d()},B=p.map((u,l)=>({...u,id:k(l),highlighted:v===l,onKeyboardClick:u.empty?R:()=>{u.changeValue(),i||d()},onClick:u.empty?R:()=>{A(l),u.changeValue(),i||d()},ref:g=>{y&&y(l,g)},role:u.empty?"button":"option",...u.empty?{}:{"aria-selected":u.active}})),F=()=>{if(e.length===0)return 0;const u=B.findIndex(l=>!l.empty&&l.active);return u===-1?0:u},w=()=>{m(),S(F())},O=u=>{const l=I.current[u];l&&h.current&&($(h.current,l,c),S(u))},N=u=>{const l=D(),g=l===0?1:l+u;g<=B.length-1&&O(g)},P=u=>{let g=D()-u;g<0&&(g=0),O(g)},L=()=>{const u=D(),l=B[u];l&&(l.onKeyboardClick(),S(u))},oe=u=>{switch(u.keyCode){case pe:{u.preventDefault(),s?L():w();break}case me:{if(a==="horizontal")return;u.preventDefault(),s?N(_):w();break}case fe:{if(a==="horizontal")return;u.preventDefault(),s?P(_):w();break}case xe:{if(a==="vertical")return;u.preventDefault(),s&&N(E);break}case ye:{if(a==="vertical")return;u.preventDefault(),s&&P(E);break}case ie:{u.preventDefault(),s?L():o&&o();break}case de:case ae:s&&(u.preventDefault(),d());break}},se=()=>{s?d():(A(F()),m())};Be({isOpen:s,getIndexToScroll:F,dropdown:h.current,optionsMapRef:I,optionsGap:c}),r.useLayoutEffect(()=>{var u,l;s?(u=h.current)==null||u.showPopover():(l=h.current)==null||l.hidePopover()},[s]);const ue=`--${C}-an`;return{pickerProps:{ref:b,onSubmit:o,onKeyDown:oe,role:"combobox","aria-controls":C,"aria-expanded":s,"aria-haspopup":"listbox","aria-label":x,style:{"--anchor-name":ue}},selectBoxProps:{active:s,onClick:se},dropdownProps:{ref:h,id:C,tabIndex:-1,role:"listbox","aria-multiselectable":i,"aria-orientation":a==="vertical"?"vertical":"horizontal","aria-activedescendant":s?k(D()):"",visible:s,popover:"manual"},optionsData:B.map(u=>{const l={...u,onKeyboardClick:void 0,changeValue:void 0};return delete l.onKeyboardClick,delete l.changeValue,l})}},Se="_selectContainer_5z8ie_1",Fe="_label_5z8ie_5",we="_select_5z8ie_1",Te="_selectBox_5z8ie_13",Ve="_selectBoxEmpty_5z8ie_54",Ae="_cleanValueButton_5z8ie_58",Re="_option_5z8ie_88",Oe="_dropdown_5z8ie_120",Ne="_divider_5z8ie_134",Pe="_optionsList_5z8ie_140",f={selectContainer:Se,label:Fe,select:we,selectBox:Te,selectBoxEmpty:Ve,cleanValueButton:Ae,option:Re,dropdown:Oe,divider:Ne,optionsList:Pe},W=({children:e})=>n.jsx("div",{className:f.selectContainer,children:e});W.__docgenInfo={description:"",methods:[],displayName:"Container"};const U=({children:e})=>n.jsx("div",{className:f.label,children:e});U.__docgenInfo={description:"",methods:[],displayName:"Label"};const G=r.forwardRef(({children:e,...t},o)=>n.jsx("div",{ref:o,className:f.select,...t,children:e}));G.__docgenInfo={description:"",methods:[],displayName:"SelectPicker"};const J=({disabled:e,empty:t,children:o,...c})=>n.jsx("button",{type:"button",disabled:e,className:re(f.selectBox,{[f.selectBoxEmpty]:t}),...c,children:o});J.__docgenInfo={description:"",methods:[],displayName:"SelectBox",props:{disabled:{required:!0,tsType:{name:"boolean"},description:""},empty:{required:!0,tsType:{name:"boolean"},description:""}}};const Q=r.forwardRef(({children:e,...t},o)=>n.jsx("div",{ref:o,className:f.dropdown,...t,children:e}));Q.__docgenInfo={description:"",methods:[],displayName:"Dropdown"};const X=r.forwardRef(({highlighted:e,content:t,...o},c)=>n.jsx("button",{ref:c,type:"button",tabIndex:-1,...o,"data-highlighted":e,className:f.cleanValueButton,children:t}));X.__docgenInfo={description:"",methods:[],displayName:"CleanValueButton"};const Y=()=>n.jsx("hr",{className:f.divider});Y.__docgenInfo={description:"",methods:[],displayName:"Divider"};const Z=({children:e})=>n.jsx("ul",{className:f.optionsList,children:e});Z.__docgenInfo={description:"",methods:[],displayName:"OptionsList"};const ee=r.forwardRef(({highlighted:e,content:t,...o},c)=>n.jsx("li",{ref:c,className:f.option,"data-highlighted":e,...o,children:t}));ee.__docgenInfo={description:"",methods:[],displayName:"Option"};const V=({value:e,onChange:t,disabled:o=!1,options:c,emptyOptionContent:p=null,label:x,placeholder:i,multiple:a=!1})=>{const E=r.useCallback((s,m)=>{if(!a){t([s]);return}t(m?e.filter(d=>s!==d):[...e,s])},[a,t,e]),_=c.map(({key:s,content:m})=>{const d=e.includes(s);return{key:s,content:m,empty:!1,active:d,changeValue:()=>E(s,d)}});p&&_.unshift({empty:!0,content:p});const{pickerProps:b,selectBoxProps:h,dropdownProps:I,optionsData:y}=je({value:e,onChange:t,rawOptionsData:_,optionsGap:5,pickerLabel:x,multiple:a,navigationOrientation:"vertical"}),C=y.reduce((s,m)=>(m.empty||(s[m.key]=m),s),{}),k=()=>e.length===0?i:a===!1?(console.log(C[e[0]].content),C[e[0]].content):e.reduce((s,m,d,v)=>(s.push(C[m].content),d!==v.length-1&&s.push(n.jsx(n.Fragment,{children:", "})),s),[]);return n.jsxs(W,{children:[n.jsx(U,{children:x}),n.jsxs(G,{...b,children:[n.jsx(J,{empty:e.length===0,disabled:o,...h,children:k()}),n.jsxs(Q,{...I,children:[y[0]&&y[0].empty&&n.jsxs(n.Fragment,{children:[n.jsx(X,{...y[0]}),y.length>0&&n.jsx(Y,{})]}),n.jsx(Z,{children:y.map(s=>s.empty?null:r.createElement(ee,{...s,key:s.key}))})]})]})]})};V.__docgenInfo={description:"",methods:[],displayName:"Select",props:{value:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"Value[]"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: Value[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"string"}],raw:"Value[]"},name:"value"}],return:{name:"void"}}},description:""},disabled:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},options:{required:!0,tsType:{name:"Array",elements:[{name:"OptionData"}],raw:"OptionData[]"},description:""},emptyOptionContent:{required:!1,tsType:{name:"union",raw:"ReactElement | string",elements:[{name:"ReactElement"},{name:"string"}]},description:"",defaultValue:{value:"null",computed:!1}},label:{required:!0,tsType:{name:"string"},description:""},placeholder:{required:!0,tsType:{name:"string"},description:""},multiple:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};const Me={title:"Popover Based/Select"},z=[{key:"1",content:n.jsx(n.Fragment,{children:"🍍 Ананас"})},{key:"2",content:n.jsx(n.Fragment,{children:"🍊 Апельсин"})},{key:"3",content:n.jsx(n.Fragment,{children:"🍌 Банан"})},{key:"4",content:n.jsx(n.Fragment,{children:"🍐 Груша"})},{key:"5",content:n.jsx(n.Fragment,{children:"🥝 Киви"})},{key:"6",content:n.jsx(n.Fragment,{children:"🥥 Кокос"})},{key:"7",content:n.jsx(n.Fragment,{children:"🍑 Персик"})},{key:"8",content:n.jsx(n.Fragment,{children:"🍎 Яблоко"})}],j={render:()=>{const[e,t]=r.useState([]),[o,c]=r.useState([]);return n.jsxs(ce,{style:{minHeight:"200vh"},children:[n.jsx(le,{children:"Селект"}),n.jsx(T,{children:"Поповер может пригодиться в качестве дропдауна для селектообразных компонентов."}),n.jsxs("div",{style:{display:"flex",gap:"20px",margin:"100px auto"},children:[n.jsx(V,{value:e,onChange:t,options:z,label:"Любимый фрукт",placeholder:"Только один",emptyOptionContent:"Любой фрукт"}),n.jsx(V,{value:o,onChange:c,options:z,label:"Любимые фрукты",placeholder:"Можно несколько",emptyOptionContent:"Любой фрукт",multiple:!0})]}),n.jsx(T,{children:"А если добавить CSS Anchor Positioning, то вообще будет песня!"}),n.jsx(T,{children:"Попробуй поскролить или изменить высоту вьюпорта."})]})}};var M,q,K;j.parameters={...j.parameters,docs:{...(M=j.parameters)==null?void 0:M.docs,source:{originalSource:`{
  render: () => {
    const [singleValue, setSingleValue] = useState<string[]>([]);
    const [multipleValue, setMultipleValue] = useState<string[]>([]);
    return <Container style={{
      minHeight: '200vh'
    }}>
                <Heading>Селект</Heading>
                <Text>Поповер может пригодиться в качестве дропдауна для селектообразных компонентов.</Text>
                <div style={{
        display: 'flex',
        gap: '20px',
        margin: '100px auto'
      }}>
                    <Select value={singleValue} onChange={setSingleValue} options={options} label="Любимый фрукт" placeholder="Только один" emptyOptionContent="Любой фрукт" />
                    <Select value={multipleValue} onChange={setMultipleValue} options={options} label="Любимые фрукты" placeholder="Можно несколько" emptyOptionContent="Любой фрукт" multiple />
                </div>

                <Text>А если добавить CSS Anchor Positioning, то вообще будет песня!</Text>
                <Text>Попробуй поскролить или изменить высоту вьюпорта.</Text>
            </Container>;
  }
}`,...(K=(q=j.parameters)==null?void 0:q.docs)==null?void 0:K.source}}};const qe=["SelectStory"];export{j as SelectStory,qe as __namedExportsOrder,Me as default};
