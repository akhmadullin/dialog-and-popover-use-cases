import{j as n,c as se}from"./index-CMu3Kjdk.js";import{r as c}from"./index-DVXBtNgz.js";import{C as re}from"./index-BK7umQ6h.js";import{w as ce,a as le}from"./css-anchor-positioning-support-warning-YNFWsKM8.js";const ae=9,ie=13,ue=27,de=32,pe=40,me=38,fe=39,xe=37,ye=(e,t,o=0)=>{e.scrollTop=t.offsetTop-o},ge=5,K=(e,t,o=ge)=>{t.offsetTop-e.scrollTop<0?ye(e,t,o):t.offsetTop+t.offsetHeight-e.scrollTop-e.clientHeight>0&&(e.scrollTop=t.offsetTop-e.clientHeight+t.offsetHeight+o)},he=e=>{const t=c.useRef(null);return c.useEffect(()=>{const o=u=>{!t.current||t.current.contains(u.target)||e(u)},l={passive:!0};return document.addEventListener("mousedown",o,l),document.addEventListener("touchstart",o,l),()=>{document.removeEventListener("mousedown",o,l),document.removeEventListener("touchstart",o,l)}},[e]),t},be=()=>{const e=c.useRef({}),t=c.useCallback((o,l)=>{if(l==null){delete e.current[o];return}e.current={...e.current,[o]:l}},[]);return[e,t]},L={isOpen:!1,keyboardFocusIndex:null,mouseFocusIndex:null},_e=()=>{const[e,t]=c.useState(L),o=c.useCallback(()=>{t(L)},[]),l=c.useCallback(()=>{t(d=>({...d,isOpen:!0}))},[]),u=c.useCallback(d=>{t(i=>({...i,keyboardFocusIndex:d,mouseFocusIndex:null}))},[]),x=c.useCallback(d=>{t(i=>({...i,mouseFocusIndex:d,keyboardFocusIndex:null}))},[]);return{...e,closeDropdown:o,openDropdown:l,setKeyboardFocusIndex:u,setMouseFocusIndex:x}},ke=()=>`${String.fromCharCode(Math.random()*26+97)}${Math.random().toString(36).substr(2,28)}`,Ce=e=>c.useMemo(()=>ke(),[e]),Ie=e=>`${e}-drpdwn`,Se=(e,t)=>`${e}-${t}`,ve=e=>{const t=Ce(e);return c.useMemo(()=>({containerId:t,dropdownId:Ie(t),getOptionId:o=>Se(t,o)}),[t])},we=({isOpen:e,getIndexToScroll:t,dropdown:o,optionsMapRef:l,optionsGap:u})=>{const[x,d]=c.useState(!1);c.useLayoutEffect(()=>{d(e)},[e]),c.useLayoutEffect(()=>{if(e&&x){const i=t(),b=l.current[i];b&&o&&K(o,b,u),d(!1)}},[o,t,e,x,u,l])},Ee=({value:e,onChange:t,onSubmit:o,optionsGap:l,rawOptionsData:u,pickerLabel:x,multiple:d,navigationOrientation:i="vertical",horizontalNavigationStep:b=1,verticalNavigationStep:k=1})=>{const C=c.useRef(null),g=c.useRef(null),[I,y]=be(),{dropdownId:_,getOptionId:S}=ve(),{isOpen:s,openDropdown:m,closeDropdown:p,keyboardFocusIndex:v,setKeyboardFocusIndex:D,mouseFocusIndex:Z,setMouseFocusIndex:B}=_e(),ee=he(()=>{s&&p()});c.useImperativeHandle(ee,()=>C.current);const w=()=>Z||v||0,O=()=>{t([]),p()},E=u.map((r,a)=>({...r,id:S(a),highlighted:v===a,onKeyboardClick:r.empty?O:()=>{r.changeValue(),d||p()},onClick:r.empty?O:()=>{B(a),r.changeValue(),d||p()},ref:h=>{y&&y(a,h)},role:r.empty?"button":"option",...r.empty?{}:{"aria-selected":r.active}})),V=()=>{if(e.length===0)return 0;const r=E.findIndex(a=>!a.empty&&a.active);return r===-1?0:r},R=()=>{m(),D(V())},F=r=>{const a=I.current[r];a&&g.current&&(K(g.current,a,l),D(r))},N=r=>{const a=w(),h=a===0?1:a+r;h<=E.length-1&&F(h)},P=r=>{let h=w()-r;h<0&&(h=0),F(h)},A=()=>{const r=w(),a=E[r];a&&(a.onKeyboardClick(),D(r))},te=r=>{switch(r.keyCode){case de:{r.preventDefault(),s?A():R();break}case pe:{if(i==="horizontal")return;r.preventDefault(),s?N(k):R();break}case me:{if(i==="horizontal")return;r.preventDefault(),s?P(k):R();break}case fe:{if(i==="vertical")return;r.preventDefault(),s&&N(b);break}case xe:{if(i==="vertical")return;r.preventDefault(),s&&P(b);break}case ie:{r.preventDefault(),s?A():o&&o();break}case ue:case ae:s&&(r.preventDefault(),p());break}},ne=()=>{s?p():(B(V()),m())};we({isOpen:s,getIndexToScroll:V,dropdown:g.current,optionsMapRef:I,optionsGap:l}),c.useLayoutEffect(()=>{var r,a;s?(r=g.current)==null||r.showPopover():(a=g.current)==null||a.hidePopover()},[s]);const oe=`--${_}-an`;return{pickerProps:{ref:C,onSubmit:o,onKeyDown:te,role:"combobox","aria-controls":_,"aria-expanded":s,"aria-haspopup":"listbox","aria-label":x,style:{"--anchor-name":oe}},selectBoxProps:{active:s,onClick:ne},dropdownProps:{ref:g,id:_,tabIndex:-1,role:"listbox","aria-multiselectable":d,"aria-orientation":i==="vertical"?"vertical":"horizontal","aria-activedescendant":s?S(w()):"",visible:s,popover:"manual"},optionsData:E.map(r=>{const a={...r,onKeyboardClick:void 0,changeValue:void 0};return delete a.onKeyboardClick,delete a.changeValue,a})}},je="_selectContainer_5ke2s_1",De="_label_5ke2s_5",Ve="_select_5ke2s_1",Re="_selectBox_5ke2s_13",Te="_selectBoxEmpty_5ke2s_54",Be="_cleanValueButton_5ke2s_58",Oe="_option_5ke2s_88",Fe="_dropdown_5ke2s_120",Ne="_divider_5ke2s_134",Pe="_optionsList_5ke2s_140",f={selectContainer:je,label:De,select:Ve,selectBox:Re,selectBoxEmpty:Te,cleanValueButton:Be,option:Oe,dropdown:Fe,divider:Ne,optionsList:Pe},H=({children:e})=>n.jsx("div",{className:f.selectContainer,children:e});H.__docgenInfo={description:"",methods:[],displayName:"Container"};const $=({children:e})=>n.jsx("div",{className:f.label,children:e});$.__docgenInfo={description:"",methods:[],displayName:"Label"};const U=c.forwardRef(({children:e,...t},o)=>n.jsx("div",{ref:o,className:f.select,...t,children:e}));U.__docgenInfo={description:"",methods:[],displayName:"SelectPicker"};const z=({disabled:e,empty:t,children:o,...l})=>n.jsx("button",{type:"button",disabled:e,className:se(f.selectBox,{[f.selectBoxEmpty]:t}),...l,children:o});z.__docgenInfo={description:"",methods:[],displayName:"SelectBox",props:{disabled:{required:!0,tsType:{name:"boolean"},description:""},empty:{required:!0,tsType:{name:"boolean"},description:""}}};const G=c.forwardRef(({children:e,...t},o)=>n.jsx("div",{ref:o,className:f.dropdown,...t,children:e}));G.__docgenInfo={description:"",methods:[],displayName:"Dropdown"};const J=c.forwardRef(({highlighted:e,content:t,...o},l)=>n.jsx("button",{ref:l,type:"button",tabIndex:-1,...o,"data-highlighted":e,className:f.cleanValueButton,children:t}));J.__docgenInfo={description:"",methods:[],displayName:"CleanValueButton"};const Q=()=>n.jsx("hr",{className:f.divider});Q.__docgenInfo={description:"",methods:[],displayName:"Divider"};const X=({children:e})=>n.jsx("ul",{className:f.optionsList,children:e});X.__docgenInfo={description:"",methods:[],displayName:"OptionsList"};const Y=c.forwardRef(({highlighted:e,content:t,...o},l)=>n.jsx("li",{ref:l,className:f.option,"data-highlighted":e,...o,children:t}));Y.__docgenInfo={description:"",methods:[],displayName:"Option"};const T=({value:e,onChange:t,disabled:o=!1,options:l,emptyOptionContent:u=null,label:x,placeholder:d,multiple:i=!1})=>{const b=c.useCallback((s,m)=>{if(!i){t([s]);return}t(m?e.filter(p=>s!==p):[...e,s])},[i,t,e]),k=l.map(({key:s,content:m})=>{const p=e.includes(s);return{key:s,content:m,empty:!1,active:p,changeValue:()=>b(s,p)}});u&&k.unshift({empty:!0,content:u});const{pickerProps:C,selectBoxProps:g,dropdownProps:I,optionsData:y}=Ee({value:e,onChange:t,rawOptionsData:k,optionsGap:5,pickerLabel:x,multiple:i,navigationOrientation:"vertical"}),_=y.reduce((s,m)=>(m.empty||(s[m.key]=m),s),{}),S=()=>e.length===0?d:i===!1?(console.log(_[e[0]].content),_[e[0]].content):e.reduce((s,m,p,v)=>(s.push(_[m].content),p!==v.length-1&&s.push(n.jsx(n.Fragment,{children:", "})),s),[]);return n.jsxs(H,{children:[n.jsx($,{children:x}),n.jsxs(U,{...C,children:[n.jsx(z,{empty:e.length===0,disabled:o,...g,children:S()}),n.jsxs(G,{...I,children:[y[0]&&y[0].empty&&n.jsxs(n.Fragment,{children:[n.jsx(J,{...y[0]}),y.length>0&&n.jsx(Q,{})]}),n.jsx(X,{children:y.map(s=>s.empty?null:c.createElement(Y,{...s,key:s.key}))})]})]})]})};T.__docgenInfo={description:"",methods:[],displayName:"Select",props:{value:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"Value[]"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: Value[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"string"}],raw:"Value[]"},name:"value"}],return:{name:"void"}}},description:""},disabled:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},options:{required:!0,tsType:{name:"Array",elements:[{name:"OptionData"}],raw:"OptionData[]"},description:""},emptyOptionContent:{required:!1,tsType:{name:"union",raw:"ReactElement | string",elements:[{name:"ReactElement"},{name:"string"}]},description:"",defaultValue:{value:"null",computed:!1}},label:{required:!0,tsType:{name:"string"},description:""},placeholder:{required:!0,tsType:{name:"string"},description:""},multiple:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};const He={title:"Popover Based/Select",decorators:[ce,le]},Ae=[{key:"1",content:n.jsx(n.Fragment,{children:"🍍 Ананас"})},{key:"2",content:n.jsx(n.Fragment,{children:"🍊 Апельсин"})},{key:"3",content:n.jsx(n.Fragment,{children:"🍌 Банан"})},{key:"4",content:n.jsx(n.Fragment,{children:"🍐 Груша"})},{key:"5",content:n.jsx(n.Fragment,{children:"🥝 Киви"})},{key:"6",content:n.jsx(n.Fragment,{children:"🥥 Кокос"})},{key:"7",content:n.jsx(n.Fragment,{children:"🍑 Персик"})},{key:"8",content:n.jsx(n.Fragment,{children:"🍎 Яблоко"})}],j={args:{options:Ae,disabled:!1,emptyOptionContent:"Любой фрукт"},argTypes:{options:{control:"object"},disabled:{control:"boolean"},emptyOptionContent:{control:"text"}},render:e=>{const[t,o]=c.useState([]),[l,u]=c.useState([]);return n.jsxs(re,{children:[n.jsx(T,{...e,value:t,onChange:o,placeholder:"Только один"}),n.jsx(T,{...e,value:l,onChange:u,placeholder:"Можно несколько",multiple:!0})]})}};var M,q,W;j.parameters={...j.parameters,docs:{...(M=j.parameters)==null?void 0:M.docs,source:{originalSource:`{
  args: {
    options,
    disabled: false,
    emptyOptionContent: 'Любой фрукт'
  },
  argTypes: {
    options: {
      control: 'object'
    },
    disabled: {
      control: 'boolean'
    },
    emptyOptionContent: {
      control: 'text'
    }
  },
  render: args => {
    const [singleValue, setSingleValue] = useState<string[]>([]);
    const [multipleValue, setMultipleValue] = useState<string[]>([]);
    return <CenteredContentWithScroll>
                <Select {...args} value={singleValue} onChange={setSingleValue} placeholder="Только один" />
                <Select {...args} value={multipleValue} onChange={setMultipleValue} placeholder="Можно несколько" multiple />
            </CenteredContentWithScroll>;
  }
}`,...(W=(q=j.parameters)==null?void 0:q.docs)==null?void 0:W.source}}};const $e=["SelectStory"];export{j as SelectStory,$e as __namedExportsOrder,He as default};
